# JARVIS Research OS - Fullstack Pipeline Configuration
# Version: 1.0.0
# Description: 文献探索〜要約〜評価〜設計提案の統一パイプライン

pipeline: fullstack

stages:
  # ============================================
  # RETRIEVAL (探索)
  # ============================================
  - retrieval.query_expand         # MeSH/同義語展開
  - retrieval.query_decompose      # クエリ分解
  - retrieval.search_bm25          # BM25検索
  - retrieval.embed_sectionwise    # セクション別埋め込み
  - retrieval.rerank_crossencoder  # CrossEncoderリランク
  - retrieval.dedup                # 重複除去
  - retrieval.cluster_map          # クラスタマップ
  
  # ============================================
  # SCREENING (採否)
  # ============================================
  - screening.pico_extract         # PICO/PECO抽出
  - screening.domain_routing       # ドメインルーティング
  - screening.study_type_classify  # in vitro/vivo/clinical判定
  - screening.oa_check             # OA判定
  - screening.filter_rules         # 除外ルール適用
  
  # ============================================
  # EXTRACTION (抽出)
  # ============================================
  - extraction.claims              # Claim抽出
  - extraction.evidence_link       # Evidence紐付け (最重要)
  - extraction.numeric             # 数値抽出 (n, p, CI, 効果量)
  - extraction.methods             # Methods抽出
  - extraction.stats               # 統計手法抽出
  - extraction.limitations         # Limitations抽出
  - extraction.figures             # Figure要点抽出
  - extraction.citations           # Citation context抽出
  
  # ============================================
  # SUMMARIZATION (要約)
  # ============================================
  - summarization.multigrain       # 多粒度要約 (300/1000/章別)
  - summarization.beginner         # 初学者向け言い換え
  - summarization.compare          # 比較要約 (一致/相違)
  - summarization.reproducibility  # 再現性要約
  - summarization.refutable        # 反証可能性要約
  
  # ============================================
  # SCORING (評価)
  # ============================================
  - scoring.importance             # 重要度スコア
  - scoring.confidence             # Claim信頼度
  - scoring.bias_risk              # バイアスリスク
  - scoring.evidence_tier          # エビデンス階層
  - scoring.clinical_relevance     # 臨床関連性
  - scoring.personal_fit           # 目的適合度
  - scoring.learning_roi           # Learning ROI
  
  # ============================================
  # KNOWLEDGE GRAPH (知識化)
  # ============================================
  - knowledge_graph.entity_normalize  # Entity正規化
  - knowledge_graph.build_and_index   # KG構築
  - knowledge_graph.controversy_map   # 論争マップ
  - knowledge_graph.timeline          # 知見更新史
  - knowledge_graph.graphrag_index    # GraphRAGインデックス
  
  # ============================================
  # EXPERIMENT DESIGN (設計)
  # ============================================
  - design.gap_analysis            # Gap分析
  - design.next_experiments        # 次実験提案
  - design.protocol_draft          # プロトコルドラフト
  - design.stats_design            # 統計設計支援
  - design.risk_diagnosis          # リスク診断
  
  # ============================================
  # SUPERVISION (Lyra監査)
  # ============================================
  - supervision.lyra.audit         # 思考品質監査
  - supervision.lyra.prompt_refine # プロンプト改善
  - supervision.lyra.reissue_tasks # タスク再発行
  
  # ============================================
  # OPS (運用)
  # ============================================
  - ops.audit_log_emit             # 監査ログ出力
  - ops.cache_optimize             # キャッシュ最適化
  - ops.failure_diagnosis          # 失敗分類
  
  # ============================================
  # UI (表示)
  # ============================================
  - ui.render_bundle               # 結果レンダリング

policies:
  # 根拠付け必須
  provenance_required: true
  
  # 根拠なしの場合は拒否
  refuse_if_no_evidence: true
  
  # キャッシュポリシー
  cache: aggressive
  
  # タイムアウト設定
  timeouts:
    stage_default_sec: 120
    extraction_sec: 300
    embedding_sec: 600
    rerank_sec: 180
  
  # 品質ゲート
  quality_gates:
    provenance_rate_min: 0.95
    facts_without_evidence_max: 0
    reproducibility_top10_match: 0.90
  
  # シード固定（再現性）
  seed: 42
  
  # デバイス設定
  device:
    default: auto
    fallback: cpu
