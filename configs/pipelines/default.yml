# JARVIS Research OS - Full-Stack Pipeline Configuration
# MASTER_SPEC.md準拠 - 全ステージ必須

name: jarvis_fullstack_v1
version: 1.0.0
description: JARVIS Research OS 完全パイプライン

# 全ステージはregistryに登録済みであること
stages:
  # Phase 1: Retrieval
  - id: retrieval.query_expand
    description: MeSH/同義語展開
    
  - id: retrieval.query_decompose
    description: クエリ分解
    
  - id: retrieval.search_bm25
    description: BM25キーワード検索
    
  - id: retrieval.embed_sectionwise
    description: セクション別埋め込み
    
  - id: retrieval.rerank_crossencoder
    description: CrossEncoderリランク
    
  - id: retrieval.dedup
    description: 重複除去
    
  - id: retrieval.cluster_map
    description: クラスタマップ

  # Phase 2: Screening
  - id: screening.pico_extract
    description: PICO/PECO抽出
    
  - id: screening.domain_routing
    description: ドメインルーティング
    
  - id: screening.study_type_classify
    description: in vitro/vivo/clinical判定
    
  - id: screening.oa_check
    description: OA判定
    
  - id: screening.filter_rules
    description: 除外ルール適用

  # Phase 3: Extraction (最重要)
  - id: extraction.claims
    description: Claim抽出
    
  - id: extraction.evidence_link
    description: Evidence紐付け（span必須）
    
  - id: extraction.numeric
    description: 数値（n, p, CI, 効果量）
    
  - id: extraction.methods
    description: Methods抽出
    
  - id: extraction.stats
    description: Stats抽出
    
  - id: extraction.limitations
    description: Limitations抽出
    
  - id: extraction.figures
    description: Figure要点抽出
    
  - id: extraction.citations
    description: Citation context抽出

  # Phase 4: Summarization
  - id: summarization.multigrain
    description: 多粒度要約（300/1000字）
    
  - id: summarization.beginner
    description: 初学者向け言い換え
    
  - id: summarization.compare
    description: 比較要約
    
  - id: summarization.reproducibility
    description: 再現性要約
    
  - id: summarization.refutable
    description: 反証可能性要約

  # Phase 5: Scoring
  - id: scoring.importance
    description: 重要度
    
  - id: scoring.confidence
    description: Claim信頼度
    
  - id: scoring.bias_risk
    description: バイアスリスク
    
  - id: scoring.evidence_tier
    description: エビデンス階層
    
  - id: scoring.clinical_relevance
    description: 臨床関連性
    
  - id: scoring.personal_fit
    description: 目的適合度
    
  - id: scoring.learning_roi
    description: 学習ROI

  # Phase 6: Knowledge Graph
  - id: knowledge_graph.entity_normalize
    description: Entity正規化
    
  - id: knowledge_graph.build_and_index
    description: KG構築・インデックス
    
  - id: knowledge_graph.controversy_map
    description: 論争マップ
    
  - id: knowledge_graph.timeline
    description: 知見更新史
    
  - id: knowledge_graph.graphrag_index
    description: GraphRAGインデックス

  # Phase 7: Design
  - id: design.gap_analysis
    description: Gap分析
    
  - id: design.next_experiments
    description: 次実験提案
    
  - id: design.protocol_draft
    description: プロトコルドラフト
    
  - id: design.stats_design
    description: 統計設計支援
    
  - id: design.risk_diagnosis
    description: リスク診断

  # Phase 8: Output
  - id: output.render_dashboard
    description: ダッシュボード出力
    
  - id: output.evidence_highlight
    description: 根拠ハイライト
    
  - id: output.score_bar
    description: スコアバー生成
    
  - id: output.comparison_view
    description: 比較ビュー出力
    
  - id: output.design_view
    description: 実験設計ビュー出力
    
  - id: output.export_bundle
    description: 結果バンドル出力

  # Phase 9: Quality Gate (必須)
  - id: quality_gate.provenance_check
    description: 根拠率チェック（≥95%）
    
  - id: quality_gate.final_audit
    description: 最終監査

# 品質ゲート設定
quality_gates:
  provenance_rate: 0.95
  facts_without_evidence: 0
  pipeline_completion: 1.0
  reproducibility: 0.90

# 再現性設定
reproducibility:
  seed: 42
  model_versions:
    sentence_transformer: "paraphrase-multilingual-MiniLM-L12-v2"
    cross_encoder: "cross-encoder/ms-marco-MiniLM-L-6-v2"
